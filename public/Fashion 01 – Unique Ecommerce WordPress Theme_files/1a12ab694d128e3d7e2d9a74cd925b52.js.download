(function($,window,undefined){'use strict';var Modernizr=window.Modernizr;$.Windy=function(options,element){this.$el=$(element);this._init(options)};$.Windy.defaults={nextEl:'',prevEl:'',boundaries:{rotateX:{min:40,max:90},rotateY:{min:-15,max:15},rotateZ:{min:-10,max:10},translateX:{min:-200,max:200},translateY:{min:-400,max:-200},translateZ:{min:250,max:550}}};$.Windy.prototype={_init:function(options){this.options=$.extend(!0,{},$.Windy.defaults,options);this.transEndEventNames={'WebkitTransition':'webkitTransitionEnd','MozTransition':'transitionend','OTransition':'oTransitionEnd','msTransition':'MSTransitionEnd','transition':'transitionend'};this.transEndEventName=this.transEndEventNames[Modernizr.prefixed('transition')];this.$items=this.$el.children('div');this.itemsCount=this.$items.length;this.resetTransformStr='translateX( 0px ) translateY( 0px ) translateZ( 0px ) rotateX( 0deg ) rotateY( 0deg ) rotateZ( 0deg )';this.supportTransitions=Modernizr.csstransitions;this.support3d=Modernizr.csstransforms3d;this.current=0;this.$items.eq(this.current).show();this._initEvents()},_getRandTransform:function(){return{rx:Math.floor(Math.random()*(this.options.boundaries.rotateX.max-this.options.boundaries.rotateX.min+1)+this.options.boundaries.rotateX.min),ry:Math.floor(Math.random()*(this.options.boundaries.rotateY.max-this.options.boundaries.rotateY.min+1)+this.options.boundaries.rotateY.min),rz:Math.floor(Math.random()*(this.options.boundaries.rotateZ.max-this.options.boundaries.rotateZ.min+1)+this.options.boundaries.rotateZ.min),tx:Math.floor(Math.random()*(this.options.boundaries.translateX.max-this.options.boundaries.translateX.min+1)+this.options.boundaries.translateX.min),ty:Math.floor(Math.random()*(this.options.boundaries.translateY.max-this.options.boundaries.translateY.min+1)+this.options.boundaries.translateY.min),tz:Math.floor(Math.random()*(this.options.boundaries.translateZ.max-this.options.boundaries.translateZ.min+1)+this.options.boundaries.translateZ.min)}},_initEvents:function(){var self=this;this.$items.on(this.transEndEventName,function(event){self._onTransEnd($(this))});if(this.options.nextEl!==''){$(this.options.nextEl).on('click.windy',function(){self.next();return!1})}
if(this.options.prevEl!==''){$(this.options.prevEl).on('click.windy',function(){self.prev();return!1})}},_onTransEnd:function(el){el.removeClass('wi-move');if(el.data('dir')==='right'){var styleStart={zIndex:1,opacity:1};if(this.support3d){styleStart.transform=this.resetTransformStr}else if(this.supportTransitions){styleStart.left=0;styleStart.top=0}
el.hide().css(styleStart)}},navigate:function(idx){var self=this,$current=this.$items.eq(this.current),$next=this.$items.eq(idx),randTranform=this._getRandTransform(),styleEnd={zIndex:this.itemsCount+1-idx,opacity:0},styleStart={opacity:1};if(this.support3d){styleStart.transform=self.resetTransformStr;styleEnd.transform='translateX('+randTranform.tx+'px) translateY('+randTranform.ty+'px) translateZ('+randTranform.tz+'px) rotateX('+randTranform.rx+'deg) rotateY('+randTranform.ry+'deg) rotateZ('+randTranform.rz+'deg)'}else if(this.supportTransitions){styleStart.left=0;styleStart.top=0;styleEnd.left=randTranform.tx;styleEnd.top=randTranform.ty}
if(idx>this.current){if(this.dir==='left'){this.$items.not($current).css('z-index',1).hide()}
this.dir='right';$current.addClass('wi-move').data('dir','right').css(styleEnd);if($next.hasClass('wi-move')){$next.removeClass('wi-move')}
$next.css(styleStart).show();if(!this.supportTransitions){this._onTransEnd($current)}}else if(idx<this.current){this.dir='left';$next.data('dir','left').css(styleEnd).show();setTimeout(function(){$next.addClass('wi-move').data('dir','left').css(styleStart);if(!self.supportTransitions){self._onTransEnd($next)}},20)}
this.current=idx},getItemsCount:function(){return this.itemsCount},next:function(){if(this.current<this.itemsCount-1){var idx=this.current+1;this.navigate(idx)}},prev:function(){if(this.current>0){var idx=this.current-1;this.navigate(idx)}},update:function(){var $currentItem=this.$items.eq(this.current);this.$items=this.$el.children('div');this.itemsCount=this.$items.length;this.current=$currentItem.index()}};var logError=function(message){if(window.console){window.console.error(message)}};$.fn.windy=function(options){var instance=$.data(this,'windy');if(typeof options==='string'){var args=Array.prototype.slice.call(arguments,1);this.each(function(){if(!instance){logError("cannot call methods on windy prior to initialization; "+"attempted to call method '"+options+"'");return}
if(!$.isFunction(instance[options])||options.charAt(0)==="_"){logError("no such method '"+options+"' for windy instance");return}
instance[options].apply(instance,args)})}else{this.each(function(){if(instance){instance._init()}else{instance=$.data(this,'windy',new $.Windy(options,this))}})}
return instance}})(jQuery,window)
;